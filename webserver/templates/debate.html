{% extends 'layout/body.html' %}

{% block title %} AI Agora {% endblock %}


{% block content %}
    <div class="content-container">
        <h1> DEBATE </h1>
        <p> ì°¬ì„± ì¸¡ ì°¸ê°€ì ì´ë¦„ : <span class="pos_name"></span></p>
        <p> ë°˜ëŒ€ ì¸¡ ì°¸ê°€ì ì´ë¦„ : <span class="neg_name"></span></p>
        <p> ì£¼ì œ : <span class="topic"></span></p>
    </div>

    {% include 'layout/chat.html' %}

    <script src="{{ url_for('static', path='js/chat.js') }}"></script>
    <script src="{{ url_for('static', path='js/autoprogress_debate.js') }}"></script>

    <script>
        document.addEventListener("DOMContentLoaded", async function() {
            const urlParams = new URLSearchParams(window.location.search);
            const debateId = urlParams.get("id");
    
            if (!debateId) {
                console.error("í† ë¡  IDê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }
    
            try {
                const response = await fetch(`/debate/info?id=${debateId}`);
                if (!response.ok) throw new Error("ì„œë²„ ì‘ë‹µ ì‹¤íŒ¨");
    
                const data = await response.json();
    
                document.querySelector(".pos_name").textContent = data.participants.pos.name || "ì•Œ ìˆ˜ ì—†ìŒ";
                document.querySelector(".neg_name").textContent = data.participants.neg.name || "ì•Œ ìˆ˜ ì—†ìŒ";
                document.querySelector(".topic").textContent = data.topic || "ì•Œ ìˆ˜ ì—†ìŒ";
    
                // ğŸ“Œ debate_log ë°ì´í„°ë¥¼ ì±„íŒ…ì°½ì— ì¶”ê°€ (ê³µìš© addMessageToChat() ì‚¬ìš©)
                if (data.debate_log && Array.isArray(data.debate_log)) {
                    data.debate_log.forEach(log => {
                        const sender = log.speaker || "ì•Œ ìˆ˜ ì—†ìŒ";
                        const message = log.timestamp + "\n" + log.message || "ë‚´ìš© ì—†ìŒ";
                        addMessageToChat(sender, message, "received");
                    });
                }

                 // ğŸ“Œ AI í† ë¡ ìê°€ ì¡´ì¬í•˜ë©´ ìë™ìœ¼ë¡œ `/debate/progress` ìš”ì²­ì„ ë°˜ë³µ ì‹¤í–‰
                 if (data.participants.pos.ai && data.participants.neg.ai) {
                    document.querySelector(".chat-input").style.display = "none";
                    autoProgressDebate(debateId);
                }

            } catch (error) {
                console.error("ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", error);
            }
        });
    </script>
    
{% endblock %}