{% extends 'layout/body.html' %}

{% block title %} AI Agora Lobby {% endblock %}


{% block content %}
    <div class="content-container">
        <h1> </h1>
        <div>
            <form action="{{ request.url_for('create_debate') }}" id="debateForm" method="post">
                <div>
                    <label for="pos">찬성 측 이름 입력:</label>
                    <input type="text" id="pos_name" name="pos_name" placeholder="찬성 측 입력">
                </div>
                <div>
                    <label for="pos">찬성 측 AI Type 입력:</label>
                    <input type="text" id="pos_ai" name="pos_ai" placeholder="GEMINI">
                </div>
                <div>
                    <label for="neg">반대 측 이름 입력:</label>
                    <input type="text" id="neg_name" name="neg_name" placeholder="반대 측 입력">
                </div>
                <div>
                    <label for="pos">반대 측 AI Type 입력:</label>
                    <input type="text" id="neg_ai" name="neg_ai" placeholder="GEMINI">
                </div>
                <div>
                    <label for="topic">주제 입력:</label>
                    <input type="text" id="topic" name="topic" placeholder="주제 입력">
                </div>
                <button type="submit">시작하기</button>
            </form>
            <script>
                document.getElementById("debateForm").addEventListener("submit", async function(event) {
                event.preventDefault(); // 기본 제출 동작 방지

                const formData = new FormData(event.target); // 폼 데이터 가져오기
                const actionUrl = event.target.action; // form의 action URL 가져오기

                try {
                    const response = await fetch(actionUrl, {
                        method: "POST",
                        body: formData // FormData를 그대로 전송
                    });

                    if (!response.ok) {
                        throw new Error("서버 응답 실패");
                    }

                    const result = await response.json(); // JSON으로 응답 받기
                    console.log("토론 생성 성공:", result);

                    if (result.id) {
                        window.location.href = `/debate/?id=${result.id}`; // 받은 ID로 페이지 이동
                    } else {
                        alert("토론 ID를 받아올 수 없습니다.");
                    }
                } catch (error) {
                    console.error("에러 발생:", error);
                    alert("토론 생성 중 오류가 발생했습니다.");
                }
            });
            </script>
        </div>
    </div>
{% endblock %}